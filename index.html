<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="–§–æ—Ä–º–∞ —Ñ—É—à–∫–∏">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>–§–æ—Ä–º–∞ —Ñ—É—à–∫–∏</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --tg-theme-bg-color: #ffffff;
      --tg-theme-text-color: #000000;
      --tg-theme-hint-color: #999999;
      --tg-theme-link-color: #2481cc;
      --tg-theme-button-color: #2481cc;
      --tg-theme-button-text-color: #ffffff;
      --primary-color: #1b4d8a;
      --primary-hover: #153d70;
      --error-color: #dc3545;
      --success-color: #28a745;
      --border-color: #e0e0e0;
      --input-bg: #ffffff;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      padding: 0;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }

    .header h1 {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .version {
      font-size: 12px;
      color: var(--tg-theme-hint-color);
      margin-top: 8px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 8px;
      color: var(--tg-theme-text-color);
    }

    .form-label .emoji {
      margin-right: 6px;
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--input-bg);
      color: var(--tg-theme-text-color);
      transition: all 0.2s ease;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(27, 77, 138, 0.1);
    }

    .form-input.error,
    .form-textarea.error {
      border-color: var(--error-color);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .form-input[type="number"]::-webkit-inner-spin-button,
    .form-input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .form-input[type="number"] {
      -moz-appearance: textfield;
    }

    .error-message {
      display: none;
      color: var(--error-color);
      font-size: 13px;
      margin-top: 6px;
    }

    .error-message.show {
      display: block;
    }

    .submit-button {
      width: 100%;
      padding: 16px;
      font-size: 17px;
      font-weight: 600;
      color: var(--tg-theme-button-text-color);
      background-color: var(--tg-theme-button-color);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 30px;
      box-shadow: var(--shadow);
    }

    .submit-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .submit-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .submit-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading-indicator {
      display: none;
      text-align: center;
      padding: 20px;
      color: var(--tg-theme-hint-color);
    }

    .loading-indicator.show {
      display: block;
    }

    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--primary-color);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .required {
      color: var(--error-color);
      margin-left: 2px;
    }

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }

      .header h1 {
        font-size: 24px;
      }

      .form-input,
      .form-textarea {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>–ù–æ–≤–∞ —Ñ—É—à–∫–∞</h1>
      <div class="version">v4.3</div>
      <div class="version" id="debug-info" style="color: #999; font-size: 10px; margin-top: 5px;"></div>
    </div>

    <form id="fushka-form" novalidate>
      <div class="form-group">
        <label class="form-label" for="description">
          <span class="emoji">üìù</span>–û–ø–∏—Å —Ñ—É—à–∫–∏<span class="required">*</span>
        </label>
        <textarea 
          id="description" 
          name="description" 
          class="form-textarea" 
          required
          maxlength="1000"
        ></textarea>
        <div class="error-message" id="description-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="company">
          <span class="emoji">üè¢</span>–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó<span class="required">*</span>
        </label>
        <input 
          id="company" 
          name="company" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="company-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="location">
          <span class="emoji">üìç</span>–õ–æ–∫–∞—Ü—ñ—è<span class="required">*</span>
        </label>
        <input 
          id="location" 
          name="location" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="location-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="date">
          <span class="emoji">üìÜ</span>–î–∞—Ç–∞<span class="required">*</span>
        </label>
        <input 
          id="date" 
          name="date" 
          class="form-input" 
          type="text" 
          required
          placeholder="–Ω–∞–ø—Ä. 10.10.2025"
          maxlength="50"
        />
        <div class="error-message" id="date-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="hours">
          <span class="emoji">‚è∞</span>–ü–æ—á–∞—Ç–æ–∫ / –∫—ñ–Ω–µ—Ü—å<span class="required">*</span>
        </label>
        <input 
          id="hours" 
          name="hours" 
          class="form-input" 
          type="text" 
          required
          placeholder="–Ω–∞–ø—Ä. 08:00 - 16:00"
          maxlength="50"
        />
        <div class="error-message" id="hours-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="rate">
          <span class="emoji">üí∞</span>–°—Ç–∞–≤–∫–∞ (Kƒç/–≥–æ–¥)<span class="required">*</span>
        </label>
        <input 
          id="rate" 
          name="rate" 
          class="form-input" 
          type="number" 
          required
          min="0"
          max="10000"
          step="0.01"
        />
        <div class="error-message" id="rate-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="type">
          <span class="emoji">üß§</span>–¢–∏–ø —Ä–æ–±–æ—Ç–∏<span class="required">*</span>
        </label>
        <input 
          id="type" 
          name="type" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="type-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="people">
          <span class="emoji">üë§</span>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π<span class="required">*</span>
        </label>
        <input 
          id="people" 
          name="people" 
          class="form-input" 
          type="number" 
          required
          min="1"
          max="1000"
          step="1"
        />
        <div class="error-message" id="people-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="note">
          <span class="emoji">üìù</span>–î–æ–¥–∞—Ç–∫–æ–≤–æ
        </label>
        <textarea 
          id="note" 
          name="note" 
          class="form-textarea"
          maxlength="1000"
        ></textarea>
        <div class="error-message" id="note-error"></div>
      </div>

      <button type="submit" class="submit-button" id="submit-btn">
        –ù–∞–¥—ñ—Å–ª–∞—Ç–∏
      </button>
    </form>

    <div class="loading-indicator" id="loading">
      <div class="spinner"></div>
      <div>–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ...</div>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function() {
      'use strict';

      let tg = null;
      let isReady = false;
      const form = document.getElementById('fushka-form');
      const submitBtn = document.getElementById('submit-btn');
      const loadingIndicator = document.getElementById('loading');
      const REQUIRED_FIELDS = ['description', 'company', 'location', 'date', 'hours', 'rate', 'type', 'people'];

      function waitForTelegram(callback, maxAttempts = 50) {
        let attempts = 0;
        
        const check = () => {
          attempts++;
          
          if (window.Telegram && window.Telegram.WebApp) {
            console.log('Telegram WebApp –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–ø—Ä–æ–±—ñ', attempts);
            callback(window.Telegram.WebApp);
            return;
          }
          
          if (attempts >= maxAttempts) {
            console.error('Telegram WebApp –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—ñ—Å–ª—è', maxAttempts, '—Å–ø—Ä–æ–±');
            alert('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Telegram WebApp. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
            return;
          }
          
          setTimeout(check, 100);
        };
        
        check();
      }

      function initTelegramWebApp(webApp) {
        try {
          tg = webApp;
          
          tg.ready();
          tg.expand();
          
          isReady = true;
          
          const debugInfo = {
            platform: tg.platform,
            version: tg.version,
            colorScheme: tg.colorScheme,
            isExpanded: tg.isExpanded,
            viewportHeight: tg.viewportHeight,
            viewportStableHeight: tg.viewportStableHeight,
            headerColor: tg.headerColor,
            backgroundColor: tg.backgroundColor,
            initDataUnsafe: tg.initDataUnsafe
          };
          
          console.log('‚úÖ WebApp —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ', debugInfo);
          
          const debugElement = document.getElementById('debug-info');
          if (debugElement) {
            debugElement.textContent = `Platform: ${tg.platform} | v${tg.version}`;
          }
          
          if (tg.themeParams) {
            const params = tg.themeParams;
            if (params.bg_color) document.documentElement.style.setProperty('--tg-theme-bg-color', params.bg_color);
            if (params.text_color) document.documentElement.style.setProperty('--tg-theme-text-color', params.text_color);
            if (params.hint_color) document.documentElement.style.setProperty('--tg-theme-hint-color', params.hint_color);
            if (params.button_color) document.documentElement.style.setProperty('--tg-theme-button-color', params.button_color);
            if (params.button_text_color) document.documentElement.style.setProperty('--tg-theme-button-text-color', params.button_text_color);
          }
        } catch (error) {
          console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó WebApp:', error);
          const debugElement = document.getElementById('debug-info');
          if (debugElement) {
            debugElement.textContent = 'ERROR: ' + error.message;
            debugElement.style.color = '#dc3545';
          }
        }
      }

      function sanitizeInput(input) {
        if (typeof input !== 'string') {
          return input;
        }
        const div = document.createElement('div');
        div.textContent = input;
        return div.innerHTML;
      }

      function validateField(fieldName, value) {
        const trimmedValue = typeof value === 'string' ? value.trim() : value;

        if (REQUIRED_FIELDS.includes(fieldName)) {
          if (!trimmedValue && trimmedValue !== 0) {
            return '–¶–µ –ø–æ–ª–µ –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ';
          }
        }

        if (fieldName === 'rate') {
          const numValue = parseFloat(value);
          if (isNaN(numValue) || numValue < 0 || numValue > 10000) {
            return '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—Ç–∞–≤–∫—É (0-10000)';
          }
        }

        if (fieldName === 'people') {
          const numValue = parseInt(value, 10);
          if (isNaN(numValue) || numValue < 1 || numValue > 1000) {
            return '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å (1-1000)';
          }
        }

        if (typeof trimmedValue === 'string' && trimmedValue.length > 1000) {
          return '–ó–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–∏–π —Ç–µ–∫—Å—Ç';
        }

        return null;
      }

      function showFieldError(fieldName, errorMessage) {
        const field = document.getElementById(fieldName);
        const errorElement = document.getElementById(`${fieldName}-error`);

        if (field) {
          field.classList.add('error');
        }

        if (errorElement && errorMessage) {
          errorElement.textContent = errorMessage;
          errorElement.classList.add('show');
        }
      }

      function clearFieldError(fieldName) {
        const field = document.getElementById(fieldName);
        const errorElement = document.getElementById(`${fieldName}-error`);

        if (field) {
          field.classList.remove('error');
        }

        if (errorElement) {
          errorElement.textContent = '';
          errorElement.classList.remove('show');
        }
      }

      function validateForm() {
        let isValid = true;
        const formData = new FormData(form);

        REQUIRED_FIELDS.forEach(fieldName => {
          clearFieldError(fieldName);
          const value = formData.get(fieldName);
          const error = validateField(fieldName, value);

          if (error) {
            showFieldError(fieldName, error);
            isValid = false;
          }
        });

        return isValid;
      }

      function collectFormData() {
        const formData = new FormData(form);
        const data = {};

        for (const [key, value] of formData.entries()) {
          const sanitizedValue = sanitizeInput(value);
          data[key] = sanitizedValue;
        }

        data.timestamp = new Date().toISOString();
        data.userAgent = navigator.userAgent.substring(0, 200);

        return data;
      }

      function sendDataToBot(data) {
        console.log('üì§ sendDataToBot –≤–∏–∫–ª–∏–∫–∞–Ω–æ');
        console.log('üì§ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É:', {
          hasTg: !!tg,
          isReady: isReady,
          tgPlatform: tg ? tg.platform : 'N/A',
          tgVersion: tg ? tg.version : 'N/A'
        });

        if (!tg || !isReady) {
          console.error('‚ùå Telegram WebApp –Ω–µ –≥–æ—Ç–æ–≤–∏–π', {
            tg: !!tg,
            isReady: isReady
          });
          return false;
        }

        try {
          const jsonData = JSON.stringify(data);
          
          console.log('üìä –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö:', {
            dataLength: jsonData.length,
            dataKeys: Object.keys(data),
            dataPreview: jsonData.substring(0, 200)
          });
          
          if (jsonData.length > 64000) {
            console.error('‚ùå –î–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ:', jsonData.length);
            throw new Error('–î–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ');
          }

          console.log('üöÄ –í–∏–∫–ª–∏–∫ tg.sendData()...');
          tg.sendData(jsonData);
          
          console.log('‚úÖ tg.sendData() –≤–∏–∫–ª–∏–∫–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
          console.log('‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç—Ç—è WebApp...');
          
          return true;
        } catch (error) {
          console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:', {
            error: error,
            message: error.message,
            stack: error.stack
          });
          return false;
        }
      }

      function handleSubmit(event) {
        event.preventDefault();

        console.log('üéØ handleSubmit –≤–∏–∫–ª–∏–∫–∞–Ω–æ');
        console.log('üéØ –°—Ç–∞–Ω –ø–µ—Ä–µ–¥ submit:', {
          isReady: isReady,
          hasTg: !!tg,
          platform: tg ? tg.platform : 'N/A',
          userId: tg && tg.initDataUnsafe ? tg.initDataUnsafe.user?.id : 'N/A'
        });

        if (!isReady || !tg) {
          console.error('‚ùå WebApp –Ω–µ –≥–æ—Ç–æ–≤–∏–π –¥–ª—è submit');
          alert('Telegram WebApp —â–µ –Ω–µ –≥–æ—Ç–æ–≤–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥.');
          return;
        }

        console.log('‚úÖ –ü–æ—á–∞—Ç–æ–∫ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ñ–æ—Ä–º–∏...');
        if (!validateForm()) {
          console.log('‚ùå –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞');
          const firstError = document.querySelector('.form-input.error, .form-textarea.error');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            firstError.focus();
          }
          return;
        }

        console.log('‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ–π–¥–µ–Ω–∞');
        submitBtn.disabled = true;
        form.style.display = 'none';
        loadingIndicator.classList.add('show');

        try {
          console.log('üìù –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ñ–æ—Ä–º–∏...');
          const data = collectFormData();
          console.log('‚úÖ –î–∞–Ω—ñ –∑—ñ–±—Ä–∞–Ω–æ:', Object.keys(data));
          
          console.log('üì§ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–æ –±–æ—Ç–∞...');
          if (sendDataToBot(data)) {
            console.log('‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —É—Å–ø—ñ—à–Ω–∞, –∑–∞–∫—Ä–∏—Ç—Ç—è —á–µ—Ä–µ–∑ 500–º—Å...');
            setTimeout(() => {
              console.log('üö™ –ó–∞–∫—Ä–∏—Ç—Ç—è WebApp...');
              tg.close();
            }, 500);
          } else {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏');
          }
        } catch (error) {
          console.error('‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ submit:', error);
          alert('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
          
          submitBtn.disabled = false;
          form.style.display = 'block';
          loadingIndicator.classList.remove('show');
        }
      }

      function setupFormValidation() {
        REQUIRED_FIELDS.forEach(fieldName => {
          const field = document.getElementById(fieldName);
          if (field) {
            field.addEventListener('blur', function() {
              const error = validateField(fieldName, this.value);
              if (error) {
                showFieldError(fieldName, error);
              } else {
                clearFieldError(fieldName);
              }
            });

            field.addEventListener('input', function() {
              if (field.classList.contains('error')) {
                clearFieldError(fieldName);
              }
            });
          }
        });
      }

      function init() {
        console.log('üöÄ === –ü–û–ß–ê–¢–û–ö –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–á –§–û–†–ú–ò ===');
        console.log('üìÖ –ß–∞—Å:', new Date().toISOString());
        console.log('üåê User Agent:', navigator.userAgent.substring(0, 100));
        console.log('üìç URL:', window.location.href);
        console.log('üîç Telegram –¥–æ—Å—Ç—É–ø–Ω–∏–π:', typeof window.Telegram !== 'undefined');
        console.log('üîç Telegram.WebApp –¥–æ—Å—Ç—É–ø–Ω–∏–π:', typeof window.Telegram?.WebApp !== 'undefined');
        
        setupFormValidation();
        form.addEventListener('submit', handleSubmit);
        
        console.log('‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Telegram WebApp...');
        waitForTelegram(initTelegramWebApp);
      }

      if (document.readyState === 'loading') {
        console.log('‚è≥ DOM —â–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è, —á–µ–∫–∞—î–º–æ DOMContentLoaded...');
        document.addEventListener('DOMContentLoaded', init);
      } else {
        console.log('‚úÖ DOM –≤–∂–µ –≥–æ—Ç–æ–≤–∏–π, –∑–∞–ø—É—Å–∫–∞—î–º–æ init...');
        init();
      }
    })();
  </script>
</body>
</html>
