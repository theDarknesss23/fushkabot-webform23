<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="–§–æ—Ä–º–∞ —Ñ—É—à–∫–∏">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>–§–æ—Ä–º–∞ —Ñ—É—à–∫–∏</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --tg-theme-bg-color: #ffffff;
      --tg-theme-text-color: #000000;
      --tg-theme-hint-color: #999999;
      --tg-theme-link-color: #2481cc;
      --tg-theme-button-color: #2481cc;
      --tg-theme-button-text-color: #ffffff;
      --primary-color: #1b4d8a;
      --primary-hover: #153d70;
      --error-color: #dc3545;
      --success-color: #28a745;
      --border-color: #e0e0e0;
      --input-bg: #ffffff;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      padding: 0;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
    }

    .header h1 {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .version {
      font-size: 12px;
      color: var(--tg-theme-hint-color);
      margin-top: 8px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 8px;
      color: var(--tg-theme-text-color);
    }

    .form-label .emoji {
      margin-right: 6px;
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--input-bg);
      color: var(--tg-theme-text-color);
      transition: all 0.2s ease;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(27, 77, 138, 0.1);
    }

    .form-input.error,
    .form-textarea.error {
      border-color: var(--error-color);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .form-input[type="number"]::-webkit-inner-spin-button,
    .form-input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .form-input[type="number"] {
      -moz-appearance: textfield;
    }

    .error-message {
      display: none;
      color: var(--error-color);
      font-size: 13px;
      margin-top: 6px;
    }

    .error-message.show {
      display: block;
    }

    .submit-button {
      width: 100%;
      padding: 16px;
      font-size: 17px;
      font-weight: 600;
      color: var(--tg-theme-button-text-color);
      background-color: var(--tg-theme-button-color);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 30px;
      box-shadow: var(--shadow);
    }

    .submit-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .submit-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .submit-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading-indicator {
      display: none;
      text-align: center;
      padding: 20px;
      color: var(--tg-theme-hint-color);
    }

    .loading-indicator.show {
      display: block;
    }

    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--primary-color);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .required {
      color: var(--error-color);
      margin-left: 2px;
    }

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }

      .header h1 {
        font-size: 24px;
      }

      .form-input,
      .form-textarea {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>–ù–æ–≤–∞ —Ñ—É—à–∫–∞</h1>
      <div class="version">v4.0</div>
    </div>

    <form id="fushka-form" novalidate>
      <div class="form-group">
        <label class="form-label" for="description">
          <span class="emoji">üìù</span>–û–ø–∏—Å —Ñ—É—à–∫–∏<span class="required">*</span>
        </label>
        <textarea 
          id="description" 
          name="description" 
          class="form-textarea" 
          required
          maxlength="1000"
        ></textarea>
        <div class="error-message" id="description-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="company">
          <span class="emoji">üè¢</span>–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó<span class="required">*</span>
        </label>
        <input 
          id="company" 
          name="company" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="company-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="location">
          <span class="emoji">üìç</span>–õ–æ–∫–∞—Ü—ñ—è<span class="required">*</span>
        </label>
        <input 
          id="location" 
          name="location" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="location-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="date">
          <span class="emoji">üìÜ</span>–î–∞—Ç–∞<span class="required">*</span>
        </label>
        <input 
          id="date" 
          name="date" 
          class="form-input" 
          type="text" 
          required
          placeholder="–Ω–∞–ø—Ä. 10.10.2025"
          maxlength="50"
        />
        <div class="error-message" id="date-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="hours">
          <span class="emoji">‚è∞</span>–ü–æ—á–∞—Ç–æ–∫ / –∫—ñ–Ω–µ—Ü—å<span class="required">*</span>
        </label>
        <input 
          id="hours" 
          name="hours" 
          class="form-input" 
          type="text" 
          required
          placeholder="–Ω–∞–ø—Ä. 08:00 - 16:00"
          maxlength="50"
        />
        <div class="error-message" id="hours-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="rate">
          <span class="emoji">üí∞</span>–°—Ç–∞–≤–∫–∞ (Kƒç/–≥–æ–¥)<span class="required">*</span>
        </label>
        <input 
          id="rate" 
          name="rate" 
          class="form-input" 
          type="number" 
          required
          min="0"
          max="10000"
          step="0.01"
        />
        <div class="error-message" id="rate-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="type">
          <span class="emoji">üß§</span>–¢–∏–ø —Ä–æ–±–æ—Ç–∏<span class="required">*</span>
        </label>
        <input 
          id="type" 
          name="type" 
          class="form-input" 
          type="text" 
          required
          maxlength="200"
        />
        <div class="error-message" id="type-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="people">
          <span class="emoji">üë§</span>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π<span class="required">*</span>
        </label>
        <input 
          id="people" 
          name="people" 
          class="form-input" 
          type="number" 
          required
          min="1"
          max="1000"
          step="1"
        />
        <div class="error-message" id="people-error"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="note">
          <span class="emoji">üìù</span>–î–æ–¥–∞—Ç–∫–æ–≤–æ
        </label>
        <textarea 
          id="note" 
          name="note" 
          class="form-textarea"
          maxlength="1000"
        ></textarea>
        <div class="error-message" id="note-error"></div>
      </div>

      <button type="submit" class="submit-button" id="submit-btn">
        –ù–∞–¥—ñ—Å–ª–∞—Ç–∏
      </button>
    </form>

    <div class="loading-indicator" id="loading">
      <div class="spinner"></div>
      <div>–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ...</div>
    </div>
  </div>

  <script>
    (function() {
      'use strict';

      const tg = window.Telegram.WebApp;
      const form = document.getElementById('fushka-form');
      const submitBtn = document.getElementById('submit-btn');
      const loadingIndicator = document.getElementById('loading');

      const REQUIRED_FIELDS = ['description', 'company', 'location', 'date', 'hours', 'rate', 'type', 'people'];

      function initTelegramWebApp() {
        try {
          tg.ready();
          tg.expand();
          
          if (tg.themeParams) {
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#999999');
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#2481cc');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
          }
        } catch (error) {
          console.error('WebApp init error:', error);
        }
      }

      function sanitizeInput(input) {
        if (typeof input !== 'string') {
          return input;
        }
        const div = document.createElement('div');
        div.textContent = input;
        return div.innerHTML;
      }

      function validateField(fieldName, value) {
        const trimmedValue = typeof value === 'string' ? value.trim() : value;

        if (REQUIRED_FIELDS.includes(fieldName)) {
          if (!trimmedValue && trimmedValue !== 0) {
            return '–¶–µ –ø–æ–ª–µ –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ';
          }
        }

        if (fieldName === 'rate') {
          const numValue = parseFloat(value);
          if (isNaN(numValue) || numValue < 0 || numValue > 10000) {
            return '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—Ç–∞–≤–∫—É (0-10000)';
          }
        }

        if (fieldName === 'people') {
          const numValue = parseInt(value, 10);
          if (isNaN(numValue) || numValue < 1 || numValue > 1000) {
            return '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å (1-1000)';
          }
        }

        if (typeof trimmedValue === 'string' && trimmedValue.length > 1000) {
          return '–ó–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–∏–π —Ç–µ–∫—Å—Ç';
        }

        return null;
      }

      function showFieldError(fieldName, errorMessage) {
        const field = document.getElementById(fieldName);
        const errorElement = document.getElementById(`${fieldName}-error`);

        if (field) {
          field.classList.add('error');
        }

        if (errorElement && errorMessage) {
          errorElement.textContent = errorMessage;
          errorElement.classList.add('show');
        }
      }

      function clearFieldError(fieldName) {
        const field = document.getElementById(fieldName);
        const errorElement = document.getElementById(`${fieldName}-error`);

        if (field) {
          field.classList.remove('error');
        }

        if (errorElement) {
          errorElement.textContent = '';
          errorElement.classList.remove('show');
        }
      }

      function validateForm() {
        let isValid = true;
        const formData = new FormData(form);

        REQUIRED_FIELDS.forEach(fieldName => {
          clearFieldError(fieldName);
          const value = formData.get(fieldName);
          const error = validateField(fieldName, value);

          if (error) {
            showFieldError(fieldName, error);
            isValid = false;
          }
        });

        return isValid;
      }

      function collectFormData() {
        const formData = new FormData(form);
        const data = {};

        for (const [key, value] of formData.entries()) {
          const sanitizedValue = sanitizeInput(value);
          data[key] = sanitizedValue;
        }

        data.timestamp = new Date().toISOString();
        data.userAgent = navigator.userAgent.substring(0, 200);

        return data;
      }

      function sendDataToBot(data) {
        try {
          const jsonData = JSON.stringify(data);
          
          if (jsonData.length > 64000) {
            throw new Error('–î–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ');
          }

          tg.sendData(jsonData);
          return true;
        } catch (error) {
          console.error('Send error:', error);
          return false;
        }
      }

      function handleSubmit(event) {
        event.preventDefault();

        if (!validateForm()) {
          const firstError = document.querySelector('.form-input.error, .form-textarea.error');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            firstError.focus();
          }
          return;
        }

        submitBtn.disabled = true;
        form.style.display = 'none';
        loadingIndicator.classList.add('show');

        try {
          const data = collectFormData();
          
          if (sendDataToBot(data)) {
            setTimeout(() => {
              tg.close();
            }, 500);
          } else {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏');
          }
        } catch (error) {
          console.error('Submit error:', error);
          alert('–ü–æ–º–∏–ª–∫–∞: ' + error.message);
          
          submitBtn.disabled = false;
          form.style.display = 'block';
          loadingIndicator.classList.remove('show');
        }
      }

      function setupFormValidation() {
        REQUIRED_FIELDS.forEach(fieldName => {
          const field = document.getElementById(fieldName);
          if (field) {
            field.addEventListener('blur', function() {
              const error = validateField(fieldName, this.value);
              if (error) {
                showFieldError(fieldName, error);
              } else {
                clearFieldError(fieldName);
              }
            });

            field.addEventListener('input', function() {
              if (field.classList.contains('error')) {
                clearFieldError(fieldName);
              }
            });
          }
        });
      }

      function init() {
        initTelegramWebApp();
        setupFormValidation();
        
        form.addEventListener('submit', handleSubmit);

        if (tg.platform === 'unknown') {
          console.warn('Not running in Telegram WebApp');
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
